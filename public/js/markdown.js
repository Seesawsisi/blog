!function(t){function e(){return"Markdown.mk_block( "+uneval(this.toString())+", "+uneval(this.trailing)+", "+uneval(this.lineNumber)+" )"}function n(){var t=require("util");return"Markdown.mk_block( "+t.inspect(this.toString())+", "+t.inspect(this.trailing)+", "+t.inspect(this.lineNumber)+" )"}function r(t){for(var e=0,n=-1;-1!==(n=t.indexOf("\n",n+1));)e++;return e}function i(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function a(t){if("string"==typeof t)return i(t);var e=t.shift(),n={},r=[];for(!t.length||"object"!=typeof t[0]||t[0]instanceof Array||(n=t.shift());t.length;)r.push(a(t.shift()));var o="";for(var s in n)o+=" "+s+'="'+i(n[s])+'"';return"img"===e||"br"===e||"hr"===e?"<"+e+o+"/>":"<"+e+o+">"+r.join("")+"</"+e+">"}function o(t,e,n){var r;n=n||{};var i=t.slice(0);"function"==typeof n.preprocessTreeNode&&(i=n.preprocessTreeNode(i,e));var a=d(i);if(a){i[1]={};for(r in a)i[1][r]=a[r];a=i[1]}if("string"==typeof i)return i;switch(i[0]){case"header":i[0]="h"+i[1].level,delete i[1].level;break;case"bulletlist":i[0]="ul";break;case"numberlist":i[0]="ol";break;case"listitem":i[0]="li";break;case"para":i[0]="p";break;case"markdown":i[0]="html",a&&delete a.references;break;case"code_block":i[0]="pre",r=a?2:1;var s=["code"];s.push.apply(s,i.splice(r,i.length-r)),i[r]=s;break;case"inlinecode":i[0]="code";break;case"img":i[1].src=i[1].href,delete i[1].href;break;case"linebreak":i[0]="br";break;case"link":i[0]="a";break;case"link_ref":i[0]="a";var l=e[a.ref];if(!l)return a.original;delete a.ref,a.href=l.href,l.title&&(a.title=l.title),delete a.original;break;case"img_ref":i[0]="img";var l=e[a.ref];if(!l)return a.original;delete a.ref,a.src=l.href,l.title&&(a.title=l.title),delete a.original}if(r=1,a){for(var c in i[1]){r=2;break}1===r&&i.splice(r,1)}for(;r<i.length;++r)i[r]=o(i[r],e,n);return i}function s(t){for(var e=d(t)?2:1;e<t.length;)"string"==typeof t[e]?e+1<t.length&&"string"==typeof t[e+1]?t[e]+=t.splice(e+1,1)[0]:++e:(s(t[e]),++e)}function l(t,e){function n(t){this.len_after=t,this.name="close_"+e}var r=t+"_state",i="strong"===t?"em_state":"strong_state";return function(a){if(this[r][0]===e)return this[r].shift(),[a.length,new n(a.length-e.length)];var o=this[i].slice(),s=this[r].slice();this[r].unshift(e);var l=this.processInline(a.substr(e.length)),c=l[l.length-1];if(this[r].shift(),c instanceof n){l.pop();var u=a.length-c.len_after;return[u,[t].concat(l)]}return this[i]=o,this[r]=s,[e.length,e]}}function c(t){for(var e=t.split(""),n=[""],r=!1;e.length;){var i=e.shift();switch(i){case" ":r?n[n.length-1]+=i:n.push("");break;case"'":case'"':r=!r;break;case"\\":i=e.shift();default:n[n.length-1]+=i}}return n}var u={};u.mk_block=function(t,r,i){1===arguments.length&&(r="\n\n");var a=new String(t);return a.trailing=r,a.inspect=n,a.toSource=e,void 0!==i&&(a.lineNumber=i),a};var h=u.isArray=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};u.forEach=Array.prototype.forEach?function(t,e,n){return t.forEach(e,n)}:function(t,e,n){for(var r=0;r<t.length;r++)e.call(n||t,t[r],r,t)},u.isEmpty=function(t){for(var e in t)if(hasOwnProperty.call(t,e))return!1;return!0},u.extract_attr=function(t){return h(t)&&t.length>1&&"object"==typeof t[1]&&!h(t[1])?t[1]:void 0};var f=function(t){switch(typeof t){case"undefined":this.dialect=f.dialects.Gruber;break;case"object":this.dialect=t;break;default:if(!(t in f.dialects))throw new Error("Unknown Markdown dialect '"+String(t)+"'");this.dialect=f.dialects[t]}this.em_state=[],this.strong_state=[],this.debug_indent=""};f.dialects={};var p=f.mk_block=u.mk_block,h=u.isArray;f.parse=function(t,e){var n=new f(e);return n.toTree(t)},f.prototype.split_blocks=function(t){t=t.replace(/(\r\n|\n|\r)/g,"\n");var e,n=/([\s\S]+?)($|\n#|\n(?:\s*\n|$)+)/g,i=[],a=1;for(null!==(e=/^(\s*\n)/.exec(t))&&(a+=r(e[0]),n.lastIndex=e[0].length);null!==(e=n.exec(t));)"\n#"===e[2]&&(e[2]="\n",n.lastIndex--),i.push(p(e[1],e[2],a)),a+=r(e[0]);return i},f.prototype.processBlock=function(t,e){var n=this.dialect.block,r=n.__order__;if("__call__"in n)return n.__call__.call(this,t,e);for(var i=0;i<r.length;i++){var a=n[r[i]].call(this,t,e);if(a)return(!h(a)||a.length>0&&!h(a[0]))&&this.debug(r[i],"didn't return a proper array"),a}return[]},f.prototype.processInline=function(t){return this.dialect.inline.__call__.call(this,String(t))},f.prototype.toTree=function(t,e){var n=t instanceof Array?t:this.split_blocks(t),r=this.tree;try{for(this.tree=e||this.tree||["markdown"];n.length;){var i=this.processBlock(n.shift(),n);i.length&&this.tree.push.apply(this.tree,i)}return this.tree}finally{e&&(this.tree=r)}},f.prototype.debug=function(){var t=Array.prototype.slice.call(arguments);t.unshift(this.debug_indent),"undefined"!=typeof print&&print.apply(print,t),"undefined"!=typeof console&&"undefined"!=typeof console.log&&console.log.apply(null,t)},f.prototype.loop_re_over_block=function(t,e,n){for(var r,i=e.valueOf();i.length&&null!==(r=t.exec(i));)i=i.substr(r[0].length),n.call(this,r);return i},f.buildBlockOrder=function(t){var e=[];for(var n in t)"__order__"!==n&&"__call__"!==n&&e.push(n);t.__order__=e},f.buildInlinePatterns=function(t){var e=[];for(var n in t)if(!n.match(/^__.*__$/)){var r=n.replace(/([\\.*+?|()\[\]{}])/g,"\\$1").replace(/\n/,"\\n");e.push(1===n.length?r:"(?:"+r+")")}e=e.join("|"),t.__patterns__=e;var i=t.__call__;t.__call__=function(t,n){return void 0!==n?i.call(this,t,n):i.call(this,t,e)}};var d=u.extract_attr;f.renderJsonML=function(t,e){e=e||{},e.root=e.root||!1;var n=[];if(e.root)n.push(a(t));else for(t.shift(),!t.length||"object"!=typeof t[0]||t[0]instanceof Array||t.shift();t.length;)n.push(a(t.shift()));return n.join("\n\n")},f.toHTMLTree=function(t,e,n){"string"==typeof t&&(t=this.parse(t,e));var r=d(t),i={};r&&r.references&&(i=r.references);var a=o(t,i,n);return s(a),a},f.toHTML=function(t,e,n){var r=this.toHTMLTree(t,e,n);return this.renderJsonML(r)};var g={};g.inline_until_char=function(t,e){for(var n=0,r=[];;){if(t.charAt(n)===e)return n++,[n,r];if(n>=t.length)return null;var i=this.dialect.inline.__oneElement__.call(this,t.substr(n));n+=i[0],r.push.apply(r,i.slice(1))}},g.subclassDialect=function(t){function e(){}function n(){}return e.prototype=t.block,n.prototype=t.inline,{block:new e,inline:new n}};var v=u.forEach,d=u.extract_attr,p=u.mk_block,m=u.isEmpty,_=g.inline_until_char,b={block:{atxHeader:function(t,e){var n=t.match(/^(#{1,6})\s*(.*?)\s*#*\s*(?:\n|$)/);if(!n)return void 0;var r=["header",{level:n[1].length}];return Array.prototype.push.apply(r,this.processInline(n[2])),n[0].length<t.length&&e.unshift(p(t.substr(n[0].length),t.trailing,t.lineNumber+2)),[r]},setextHeader:function(t,e){var n=t.match(/^(.*)\n([-=])\2\2+(?:\n|$)/);if(!n)return void 0;var r="="===n[2]?1:2,i=["header",{level:r},n[1]];return n[0].length<t.length&&e.unshift(p(t.substr(n[0].length),t.trailing,t.lineNumber+2)),[i]},code:function(t,e){var n=[],r=/^(?: {0,3}\t| {4})(.*)\n?/;if(!t.match(r))return void 0;t:for(;;){var i=this.loop_re_over_block(r,t.valueOf(),function(t){n.push(t[1])});if(i.length){e.unshift(p(i,t.trailing));break t}if(!e.length)break t;if(!e[0].match(r))break t;n.push(t.trailing.replace(/[^\n]/g,"").substring(2)),t=e.shift()}return[["code_block",n.join("\n")]]},horizRule:function(t,e){var n=t.match(/^(?:([\s\S]*?)\n)?[ \t]*([-_*])(?:[ \t]*\2){2,}[ \t]*(?:\n([\s\S]*))?$/);if(!n)return void 0;var r=[["hr"]];if(n[1]){var i=p(n[1],"",t.lineNumber);r.unshift.apply(r,this.toTree(i,[]))}return n[3]&&e.unshift(p(n[3],t.trailing,t.lineNumber+1)),r},lists:function(){function t(t){return new RegExp("(?:^("+l+"{0,"+t+"} {0,3})("+a+")\\s+)|"+"(^"+l+"{0,"+(t-1)+"}[ ]{0,4})")}function e(t){return t.replace(/ {0,3}\t/g,"    ")}function n(t,e,n,r){if(e)return t.push(["para"].concat(n)),void 0;var i=t[t.length-1]instanceof Array&&"para"===t[t.length-1][0]?t[t.length-1]:t;r&&t.length>1&&n.unshift(r);for(var a=0;a<n.length;a++){var o=n[a],s="string"==typeof o;s&&i.length>1&&"string"==typeof i[i.length-1]?i[i.length-1]+=o:i.push(o)}}function r(t,e){for(var n=new RegExp("^("+l+"{"+t+"}.*?\\n?)*$"),r=new RegExp("^"+l+"{"+t+"}","gm"),i=[];e.length>0&&n.exec(e[0]);){var a=e.shift(),o=a.replace(r,"");i.push(p(o,a.trailing,a.lineNumber))}return i}function i(t,e,n){var r=t.list,i=r[r.length-1];if(!(i[1]instanceof Array&&"para"===i[1][0]))if(e+1===n.length)i.push(["para"].concat(i.splice(1,i.length-1)));else{var a=i.pop();i.push(["para"].concat(i.splice(1,i.length-1)),a)}}var a="[*+-]|\\d+\\.",o=/[*+-]/,s=new RegExp("^( {0,3})("+a+")[ 	]+"),l="(?: {0,3}\\t| {4})";return function(a,l){function c(t){var e=o.exec(t[2])?["bulletlist"]:["numberlist"];return p.push({list:e,indent:t[1]}),e}var u=a.match(s);if(!u)return void 0;for(var h,f,p=[],d=c(u),g=!1,m=[p[0].list];;){for(var _=a.split(/(?=\n)/),b="",k="",y=0;y<_.length;y++){k="";var $=_[y].replace(/^\n/,function(t){return k=t,""}),w=t(p.length);if(u=$.match(w),void 0!==u[1]){b.length&&(n(h,g,this.processInline(b),k),g=!1,b=""),u[1]=e(u[1]);var R=Math.floor(u[1].length/4)+1;if(R>p.length)d=c(u),h.push(d),h=d[1]=["listitem"];else{var C=!1;for(f=0;f<p.length;f++)if(p[f].indent===u[1]){d=p[f].list,p.splice(f+1,p.length-(f+1)),C=!0;break}C||(R++,R<=p.length?(p.splice(R,p.length-R),d=p[R-1].list):(d=c(u),h.push(d))),h=["listitem"],d.push(h)}k=""}$.length>u[0].length&&(b+=k+$.substr(u[0].length))}b.length&&(n(h,g,this.processInline(b),k),g=!1,b="");var M=r(p.length,l);M.length>0&&(v(p,i,this),h.push.apply(h,this.toTree(M,[])));var T=l[0]&&l[0].valueOf()||"";if(!T.match(s)&&!T.match(/^ /))break;a=l.shift();var x=this.dialect.block.horizRule(a,l);if(x){m.push.apply(m,x);break}v(p,i,this),g=!0}return m}}(),blockquote:function(t,e){if(!t.match(/^>/m))return void 0;var n=[];if(">"!==t[0]){for(var r=t.split(/\n/),i=[],a=t.lineNumber;r.length&&">"!==r[0][0];)i.push(r.shift()),a++;var o=p(i.join("\n"),"\n",t.lineNumber);n.push.apply(n,this.processBlock(o,[])),t=p(r.join("\n"),t.trailing,a)}for(;e.length&&">"===e[0][0];){var s=e.shift();t=p(t+t.trailing+s,s.trailing,t.lineNumber)}var l=t.replace(/^> ?/gm,""),c=(this.tree,this.toTree(l,["blockquote"])),u=d(c);return u&&u.references&&(delete u.references,m(u)&&c.splice(1,1)),n.push(c),n},referenceDefn:function(t,e){var n=/^\s*\[(.*?)\]:\s*(\S+)(?:\s+(?:(['"])(.*?)\3|\((.*?)\)))?\n?/;if(!t.match(n))return void 0;d(this.tree)||this.tree.splice(1,0,{});var r=d(this.tree);void 0===r.references&&(r.references={});var i=this.loop_re_over_block(n,t,function(t){t[2]&&"<"===t[2][0]&&">"===t[2][t[2].length-1]&&(t[2]=t[2].substring(1,t[2].length-1));var e=r.references[t[1].toLowerCase()]={href:t[2]};void 0!==t[4]?e.title=t[4]:void 0!==t[5]&&(e.title=t[5])});return i.length&&e.unshift(p(i,t.trailing)),[]},para:function(t){return[["para"].concat(this.processInline(t))]}},inline:{__oneElement__:function(t,e,n){var r,i;e=e||this.dialect.inline.__patterns__;var a=new RegExp("([\\s\\S]*?)("+(e.source||e)+")");if(r=a.exec(t),!r)return[t.length,t];if(r[1])return[r[1].length,r[1]];var i;return r[2]in this.dialect.inline&&(i=this.dialect.inline[r[2]].call(this,t.substr(r.index),r,n||[])),i=i||[r[2].length,r[2]]},__call__:function(t,e){function n(t){"string"==typeof t&&"string"==typeof i[i.length-1]?i[i.length-1]+=t:i.push(t)}for(var r,i=[];t.length>0;)r=this.dialect.inline.__oneElement__.call(this,t,e,i),t=t.substr(r.shift()),v(r,n);return i},"]":function(){},"}":function(){},__escape__:/^\\[\\`\*_{}\[\]()#\+.!\-]/,"\\":function(t){return this.dialect.inline.__escape__.exec(t)?[2,t.charAt(1)]:[1,"\\"]},"![":function(t){var e=t.match(/^!\[(.*?)\][ \t]*\([ \t]*([^")]*?)(?:[ \t]+(["'])(.*?)\3)?[ \t]*\)/);if(e){e[2]&&"<"===e[2][0]&&">"===e[2][e[2].length-1]&&(e[2]=e[2].substring(1,e[2].length-1)),e[2]=this.dialect.inline.__call__.call(this,e[2],/\\/)[0];var n={alt:e[1],href:e[2]||""};return void 0!==e[4]&&(n.title=e[4]),[e[0].length,["img",n]]}return e=t.match(/^!\[(.*?)\][ \t]*\[(.*?)\]/),e?[e[0].length,["img_ref",{alt:e[1],ref:e[2].toLowerCase(),original:e[0]}]]:[2,"!["]},"[":function y(t){var e=String(t),n=_.call(this,t.substr(1),"]");if(!n)return[1,"["];var y,r,i=1+n[0],a=n[1];t=t.substr(i);var o=t.match(/^\s*\([ \t]*([^"']*)(?:[ \t]+(["'])(.*?)\2)?[ \t]*\)/);if(o){var s=o[1];if(i+=o[0].length,s&&"<"===s[0]&&">"===s[s.length-1]&&(s=s.substring(1,s.length-1)),!o[3])for(var l=1,c=0;c<s.length;c++)switch(s[c]){case"(":l++;break;case")":0===--l&&(i-=s.length-c,s=s.substring(0,c))}return s=this.dialect.inline.__call__.call(this,s,/\\/)[0],r={href:s||""},void 0!==o[3]&&(r.title=o[3]),y=["link",r].concat(a),[i,y]}return o=t.match(/^\s*\[(.*?)\]/),o?(i+=o[0].length,r={ref:(o[1]||String(a)).toLowerCase(),original:e.substr(0,i)},y=["link_ref",r].concat(a),[i,y]):1===a.length&&"string"==typeof a[0]?(r={ref:a[0].toLowerCase(),original:e.substr(0,i)},y=["link_ref",r,a[0]],[i,y]):[1,"["]},"<":function(t){var e;return null!==(e=t.match(/^<(?:((https?|ftp|mailto):[^>]+)|(.*?@.*?\.[a-zA-Z]+))>/))?e[3]?[e[0].length,["link",{href:"mailto:"+e[3]},e[3]]]:"mailto"===e[2]?[e[0].length,["link",{href:e[1]},e[1].substr("mailto:".length)]]:[e[0].length,["link",{href:e[1]},e[1]]]:[1,"<"]},"`":function(t){var e=t.match(/(`+)(([\s\S]*?)\1)/);return e&&e[2]?[e[1].length+e[2].length,["inlinecode",e[3]]]:[1,"`"]},"  \n":function(){return[3,["linebreak"]]}}};b.inline["**"]=l("strong","**"),b.inline.__=l("strong","__"),b.inline["*"]=l("em","*"),b.inline._=l("em","_"),f.dialects.Gruber=b,f.buildBlockOrder(f.dialects.Gruber.block),f.buildInlinePatterns(f.dialects.Gruber.inline);var k=g.subclassDialect(b),d=u.extract_attr,v=u.forEach;k.processMetaHash=function(t){for(var e=c(t),n={},r=0;r<e.length;++r)if(/^#/.test(e[r]))n.id=e[r].substring(1);else if(/^\./.test(e[r]))n["class"]=n["class"]?n["class"]+e[r].replace(/./," "):e[r].substring(1);else if(/\=/.test(e[r])){var i=e[r].split(/\=/);n[i[0]]=i[1]}return n},k.block.document_meta=function(t){if(t.lineNumber>1)return void 0;if(!t.match(/^(?:\w+:.*\n)*\w+:.*$/))return void 0;d(this.tree)||this.tree.splice(1,0,{});var e=t.split(/\n/);for(var n in e){var r=e[n].match(/(\w+):\s*(.*)$/),i=r[1].toLowerCase(),a=r[2];this.tree[1][i]=a}return[]},k.block.block_meta=function(t){var e=t.match(/(^|\n) {0,3}\{:\s*((?:\\\}|[^\}])*)\s*\}$/);if(!e)return void 0;var n,r=this.dialect.processMetaHash(e[2]);if(""===e[1]){var i=this.tree[this.tree.length-1];if(n=d(i),"string"==typeof i)return void 0;n||(n={},i.splice(1,0,n));for(var a in r)n[a]=r[a];return[]}var o=t.replace(/\n.*$/,""),s=this.processBlock(o,[]);n=d(s[0]),n||(n={},s[0].splice(1,0,n));for(var a in r)n[a]=r[a];return s},k.block.definition_list=function(t,e){var n,r,i=/^((?:[^\s:].*\n)+):\s+([\s\S]+)$/,a=["dl"];if(!(r=t.match(i)))return void 0;for(var o=[t];e.length&&i.exec(e[0]);)o.push(e.shift());for(var s=0;s<o.length;++s){var r=o[s].match(i),l=r[1].replace(/\n$/,"").split(/\n/),c=r[2].split(/\n:\s+/);for(n=0;n<l.length;++n)a.push(["dt",l[n]]);for(n=0;n<c.length;++n)a.push(["dd"].concat(this.processInline(c[n].replace(/(\n)\s+/,"$1"))))}return[a]},k.block.table=function $(t){var e,n,r=function(t,e){e=e||"\\s",e.match(/^[\\|\[\]{}?*.+^$]$/)&&(e="\\"+e);for(var n,r=[],i=new RegExp("^((?:\\\\.|[^\\\\"+e+"])*)"+e+"(.*)");n=t.match(i);)r.push(n[1]),t=n[2];return r.push(t),r},i=/^ {0,3}\|(.+)\n {0,3}\|\s*([\-:]+[\-| :]*)\n((?:\s*\|.*(?:\n|$))*)(?=\n|$)/,a=/^ {0,3}(\S(?:\\.|[^\\|])*\|.*)\n {0,3}([\-:]+\s*\|[\-| :]*)\n((?:(?:\\.|[^\\|])*\|.*(?:\n|$))*)(?=\n|$)/;if(n=t.match(i))n[3]=n[3].replace(/^\s*\|/gm,"");else if(!(n=t.match(a)))return void 0;var $=["table",["thead",["tr"]],["tbody"]];n[2]=n[2].replace(/\|\s*$/,"").split("|");var o=[];for(v(n[2],function(t){t.match(/^\s*-+:\s*$/)?o.push({align:"right"}):t.match(/^\s*:-+\s*$/)?o.push({align:"left"}):t.match(/^\s*:-+:\s*$/)?o.push({align:"center"}):o.push({})}),n[1]=r(n[1].replace(/\|\s*$/,""),"|"),e=0;e<n[1].length;e++)$[1][1].push(["th",o[e]||{}].concat(this.processInline(n[1][e].trim())));return v(n[3].replace(/\|\s*$/gm,"").split("\n"),function(t){var n=["tr"];for(t=r(t,"|"),e=0;e<t.length;e++)n.push(["td",o[e]||{}].concat(this.processInline(t[e].trim())));$[2].push(n)},this),[$]},k.inline["{:"]=function(t,e,n){if(!n.length)return[2,"{:"];var r=n[n.length-1];if("string"==typeof r)return[2,"{:"];var i=t.match(/^\{:\s*((?:\\\}|[^\}])*)\s*\}/);if(!i)return[2,"{:"];var a=this.dialect.processMetaHash(i[1]),o=d(r);o||(o={},r.splice(1,0,o));for(var s in a)o[s]=a[s];return[i[0].length,""]},f.dialects.Maruku=k,f.dialects.Maruku.inline.__escape__=/^\\[\\`\*_{}\[\]()#\+.!\-|:]/,f.buildBlockOrder(f.dialects.Maruku.block),f.buildInlinePatterns(f.dialects.Maruku.inline),t.Markdown=f,t.parse=f.parse,t.toHTML=f.toHTML,t.toHTMLTree=f.toHTMLTree,t.renderJsonML=f.renderJsonML}(function(){return window.markdown={},window.markdown}());