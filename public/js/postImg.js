!function(){function t(t,e){this.update=function(){e.innerHTML=markdown.toHTML(t.value)},t.editor=this,this.update()}function e(t,e){if(document.selection){var n=document.selection.createRange();n.text=e}else if("number"==typeof t.selectionStart&&"number"==typeof t.selectionEnd){var r=t.selectionStart,i=t.selectionEnd,a=r,o=t.value;t.value=o.substring(0,r)+e+o.substring(i,o.length),a+=e.length,t.selectionStart=t.selectionEnd=a}else t.value+=e}function n(t,e,n){if("undefined"==typeof FormData)throw new Error("FormData is not implemented");var r=new XMLHttpRequest;r.open("POST",t),r.onreadystatechange=function(){4===r.readyState&&n&&n(r)};var i=new FormData;for(var a in e)if(e.hasOwnProperty(a)){var o=e[a];"function"!=typeof o&&i.append(a,o)}r.send(i)}var r=$("#hidden"),i=document.getElementById("post"),a=($("#post-content"),$("#post-title"),$(".post-title_input"),$("#post-btn")),o=$("#post"),s=function(t,e,n){$.ajax({type:"POST",url:t,data:e,success:function(t){return 1!==n?!1:(3===t.type?(noty({text:t.mes,type:"success",timeout:2e3,killer:!1,dismissQueue:!0,layout:"topCenter"}),setTimeout(function(){location.href=t.url},2e3)):console.log("葫芦娃"),void 0)}})},l=function(t){return document.getElementById(t)};new t(l("post"),l("preview")),$(document).on({dragleave:function(t){t.preventDefault()},drop:function(t){t.preventDefault()},dragenter:function(t){t.preventDefault()},dragover:function(t){t.preventDefault()}}),i.addEventListener("drop",function(a){a.preventDefault();var o=a.dataTransfer.files,s={},c="/post/"+r.val();return 0===o.length?!1:-1===o[0].type.indexOf("image")?!1:(s.image=o[0],n(c,s,function(n){e(i,"![15]("+n.response+")"),new t(l("post"),l("preview"))}),void 0)},!1),a.click(function(){if(""==o.val())return!1;var t=$("#post").val(),e=$("#tag").val().replace(/(，)|(\t)|(,)|(-)|(\.)|(:)|(--)|(\s)|(：)|(。)|(\|)/g,";"),n=$("#title").val();post={},post.content=t,post.title=null!=n?n:t.substr(0,10),post.tag=e,s(location.pathname,post,1)}),$("#tag").keydown(function(t){return 13===t.keyCode?!1:void 0})}();var Preview=$.extend({},{init:function(){var t=$(".preview-container"),e=$(".editor-container"),n=this;$(".btn-preview").click(function(){t.hasClass("show")?(t.removeClass("show"),e.css("opacity",1)):(t.css("height",n.getHeight(e)).addClass("show"),e.css("opacity",0))})},getHeight:function(t){return t.outerHeight()},enable:function(){this.init()}});