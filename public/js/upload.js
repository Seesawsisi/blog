$(function(){function t(t,e,n){if("undefined"==typeof FormData)throw new Error("FormData is not implemented");var r=new XMLHttpRequest;r.open("POST",t),r.onreadystatechange=function(){4===r.readyState&&n&&n(r)};var i=new FormData;for(var a in e)if(e.hasOwnProperty(a)){var o=e[a];"function"!=typeof o&&i.append(a,o)}r.send(i)}$(document).on({dragleave:function(t){t.preventDefault()},drop:function(t){t.preventDefault()},dragenter:function(t){t.preventDefault()},dragover:function(t){t.preventDefault()}});var e,n,r=document.getElementById("upload-drag"),i=0,a={},o="/upload",s=$('<div class="modal fade" data-keyboard="true" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true"></div>').append('<div class="modal-header"><h3 id="myModalLabel">提示</h3></div>').append('<div class="modal-body"><p>你拖的不图片！</p></div>'),l=function(t){var e=t.parent("a").data("file");t.parent("a").remove(),e in a&&delete a[e]},u=function(){return $('<a href="#"></a>').addClass("thumbnail").append($('<a href="#" data-toggle="tooltip" title="删除">&times;</a>').addClass("close-img").click(function(){l($(this))}))};r.addEventListener("drop",function(t){t.preventDefault();var r=t.dataTransfer.files;if(0==r.length)return!1;if(-1===r[0].type.indexOf("image"))return s.modal(),!1;window.URL=window.URL||window.webkitURL;var o=window.URL.createObjectURL(r[0]);r[0].name;var l=Math.floor(r[0].size/1024);if(l>500)return alert("上传大小不能超过500K."),!1;var c="<img src='"+o+"'>";e=u(),i+=1,n="file"+i,a[n]=r[0],e.append(c).data("file",n),$("#upload-drag").append(e)},!1),$(".upload-submit").click(function(){""!=r.innerHTML&&t(o,a,function(){r.innerHTML="",a=[],i=0})})});